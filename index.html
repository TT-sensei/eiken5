<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eiken Grade 5 Challenge</title>
    <style>
        /* „Éá„Ç∂„Ç§„É≥Ë®≠ÂÆöÔºöÂ≠ê‰æõÂêë„Åë„Å´Â§ß„Åç„Åè„ÄÅ„Ç∑„É≥„Éó„É´„Å´ */
        :root {
            --primary: #4A90E2;
            --success: #2ECC71;
            --danger: #E74C3C;
            --bg: #F0F4F8;
            --card: #FFFFFF;
        }

        body {
            font-family: 'Verdana', sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            user-select: none;
        }

        .container {
            background: var(--card);
            width: 90%;
            max-width: 500px;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
        }

        h1 { color: var(--primary); margin-bottom: 10px; }
        h2 { color: #555; font-size: 1.2rem; }

        /* „Éú„Çø„É≥ÂÖ±ÈÄö„Çπ„Çø„Ç§„É´ */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.1s;
            margin: 10px;
            width: 80%;
            font-weight: bold;
        }
        .btn:active { transform: scale(0.95); }
        .btn-secondary { background: #95a5a6; }

        /* „ÇØ„Ç§„Ç∫ÁîªÈù¢ */
        #quiz-section { display: none; }
        .question-box {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin: 30px 0;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .options-grid {
            display: grid;
            gap: 15px;
        }
        .option-btn {
            background: white;
            border: 3px solid var(--primary);
            color: #333;
            padding: 15px;
            font-size: 1.2rem;
            border-radius: 15px;
            cursor: pointer;
        }
        .option-btn:hover { background: #eef6ff; }
        
        /* Ê≠£Ëß£„Éª‰∏çÊ≠£Ëß£„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà */
        .correct { background: var(--success) !important; color: white !important; border-color: var(--success) !important; }
        .wrong { background: var(--danger) !important; color: white !important; border-color: var(--danger) !important; }

        /* ÁµêÊûúÁîªÈù¢ */
        #result-section { display: none; }
        .score-display { font-size: 3rem; color: var(--primary); margin: 20px 0; }
        .stamp-reveal { font-size: 4rem; animation: pop 0.5s; margin: 20px 0; }

        /* „Çπ„Çø„É≥„ÉóÂ∏≥ */
        #stamp-book-section { display: none; }
        .stamp-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        .stamp-slot {
            aspect-ratio: 1;
            background: #eee;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            position: relative;
        }
        .stamp-slot.locked { filter: grayscale(100%); opacity: 0.3; }
        
        /* „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÔºàÊó•Êú¨Ë™ûË®≥Áî®Ôºâ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            animation: pop 0.3s;
        }
        .jp-word { font-size: 2rem; color: var(--primary); font-weight: bold; margin: 10px 0; }

        @keyframes pop {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

<div class="container">
    <div id="start-section">
        <h1>ENGLISH CHALLENGE</h1>
        <p>Grade 5 Level</p>
        <button class="btn" onclick="startQuiz()">START</button>
        <br>
        <button class="btn btn-secondary" onclick="showStampBook()">MY STAMPS</button>
    </div>

    <div id="quiz-section">
        <h2 id="progress-text">Question 1/10</h2>
        <div class="question-box" id="question-text">
            </div>
        <div class="options-grid" id="options-container">
            </div>
    </div>

    <div id="result-section">
        <h2 id="result-title">RESULT</h2>
        <div class="score-display" id="score-text"></div>
        <div id="reward-area"></div>
        <button class="btn" onclick="toTitle()">BACK TO TITLE</button>
    </div>

    <div id="stamp-book-section">
        <h2>MY COLLECTION</h2>
        <p>Tap to see meaning</p>
        <div class="stamp-grid" id="stamp-grid"></div>
        <button class="btn" onclick="toTitle()">CLOSE</button>
    </div>
</div>

<div class="modal" id="modal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div style="font-size:4rem;" id="modal-icon"></div>
        <div class="jp-word" id="modal-jp"></div>
        <button class="btn" onclick="closeModal()">OK</button>
    </div>
</div>

<script>
    // --- 1. „Éá„Éº„Çø„Çª„ÉÉ„Éà (Ëã±Ê§ú5Á¥ö„É¨„Éô„É´„Éª„Ç™„É™„Ç∏„Éä„É´) ---
    // „Çπ„Çø„É≥„ÉóID„Å®ÈÄ£Êê∫„Åï„Åõ„Çã„Åü„ÇÅ„ÄÅvocab„ÅÆÊ≠£Ëß£„ÉØ„Éº„Éâ„Çí„Ç≠„Éº„Å´„Åó„Åæ„Åô
    const questionPool = [
        // ÂçòË™û (Context)
        { q: "I eat an ( ) every morning.", opts: ["apple", "book", "car", "sky"], ans: 0 },
        { q: "My father drives a ( ).", opts: ["bus", "cat", "pen", "cup"], ans: 0 },
        { q: "Do you play ( )?", opts: ["soccer", "desk", "dog", "bag"], ans: 0 },
        { q: "This is a big ( ).", opts: ["house", "run", "happy", "fast"], ans: 0 },
        { q: "I go to ( ) by bus.", opts: ["school", "apple", "bed", "red"], ans: 0 },
        // ‰ºöË©± (Conversation)
        { q: "A: Happy Birthday!<br>B: ( ).", opts: ["Thank you.", "I'm sorry.", "Good bye.", "Yes, I am."], ans: 0 },
        { q: "A: Nice to meet you.<br>B: ( ).", opts: ["Nice to meet you, too.", "You are welcome.", "Good morning.", "I like it."], ans: 0 },
        { q: "A: How are you?<br>B: ( ).", opts: ["I'm fine.", "It is a pen.", "Yes, I do.", "Good night."], ans: 0 },
        { q: "A: Here you are.<br>B: ( ).", opts: ["Thank you.", "No, it is not.", "I am happy.", "See you."], ans: 0 },
        // ÊñáÊ≥ï (Grammar)
        { q: "( ) you like music?", opts: ["Do", "Are", "Is", "Does"], ans: 0 },
        { q: "She ( ) my sister.", opts: ["is", "am", "are", "go"], ans: 0 },
        { q: "I ( ) tennis on Sundays.", opts: ["play", "plays", "playing", "player"], ans: 0 },
        { q: "That ( ) a dog.", opts: ["is", "are", "do", "am"], ans: 0 },
        { q: "What ( ) this?", opts: ["is", "are", "do", "does"], ans: 0 },
        { q: "Let's ( ) to the park.", opts: ["go", "going", "goes", "to go"], ans: 0 }
    ];

    // --- 2. „Çπ„Çø„É≥„Éó„Éá„Éº„Çø (ID, ÁµµÊñáÂ≠ó, Êó•Êú¨Ë™ûË®≥) ---
    const stampData = [
        { id: 1, icon: "üçé", word: "Apple", jp: "„Çä„Çì„Åî" },
        { id: 2, icon: "üöå", word: "Bus", jp: "„Éê„Çπ" },
        { id: 3, icon: "‚öΩ", word: "Soccer", jp: "„Çµ„ÉÉ„Ç´„Éº" },
        { id: 4, icon: "üè†", word: "House", jp: "„ÅÑ„Åà" },
        { id: 5, icon: "üè´", word: "School", jp: "„Åå„Å£„Åì„ÅÜ" },
        { id: 6, icon: "üéÅ", word: "Present", jp: "„Éó„É¨„Çº„É≥„Éà" },
        { id: 7, icon: "ü§ù", word: "Friend", jp: "„Å®„ÇÇ„Å†„Å°" },
        { id: 8, icon: "üòä", word: "Smile", jp: "„Åà„Åå„Åä" },
        { id: 9, icon: "üê∂", word: "Dog", jp: "„ÅÑ„Å¨" },
        { id: 10, icon: "üê±", word: "Cat", jp: "„Å≠„Åì" },
        { id: 11, icon: "üëë", word: "King", jp: "„Åä„ÅÜ„Åï„Åæ" },
        { id: 12, icon: "‚≠ê", word: "Star", jp: "„Åª„Åó" }
    ];

    // --- 3. Â§âÊï∞ÁÆ°ÁêÜ ---
    let currentQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let userStamps = JSON.parse(localStorage.getItem('eiken5_stamps')) || []; // ‰øùÂ≠ò„Éá„Éº„ÇøË™≠„ÅøËæº„Åø

    // --- 4. „Ç≤„Éº„É†„É≠„Ç∏„ÉÉ„ÇØ ---

    function startQuiz() {
        // ÂïèÈ°å„Çí„Ç∑„É£„ÉÉ„Éï„É´„Åó„Å¶10ÂïèÈÅ∏„Å∂
        const shuffled = [...questionPool].sort(() => 0.5 - Math.random());
        currentQuestions = shuffled.slice(0, 10);
        
        currentIndex = 0;
        score = 0;
        
        showSection('quiz-section');
        showQuestion();
    }

    function showQuestion() {
        const qData = currentQuestions[currentIndex];
        document.getElementById('progress-text').innerText = `Question ${currentIndex + 1}/10`;
        document.getElementById('question-text').innerHTML = qData.q;
        
        const optionsDiv = document.getElementById('options-container');
        optionsDiv.innerHTML = "";

        // ÈÅ∏ÊäûËÇ¢„ÇÇ„Ç∑„É£„ÉÉ„Éï„É´„Åô„Çã„Åü„ÇÅ„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„ÇπÈÖçÂàó
        let optIndices = [0, 1, 2, 3];
        optIndices.sort(() => 0.5 - Math.random());

        optIndices.forEach(idx => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = qData.opts[idx];
            btn.onclick = () => checkAnswer(btn, idx, qData.ans);
            optionsDiv.appendChild(btn);
        });
    }

    function checkAnswer(btn, selectedIdx, correctIdx) {
        // ÈÄ£ÊâìÈò≤Ê≠¢
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        if (selectedIdx === correctIdx) {
            btn.classList.add('correct');
            score++;
            // Èü≥„ÇíÈ≥¥„Çâ„Åô„Å™„Çâ„Åì„Åì„Åß new Audio('correct.mp3').play();
        } else {
            btn.classList.add('wrong');
            // Ê≠£Ëß£„ÇíË°®Á§∫
            allBtns.forEach((b, i) => {
                // „Éú„Çø„É≥„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Åã„ÇâÂÖÉ„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÇíÊé¢„Åô„ÅÆ„ÅØÈù¢ÂÄí„Å™„ÅÆ„Åß„ÄÅ
                // Ê≠£Ëß£„ÅÆ„Éú„Çø„É≥„ÇíÊé¢„Åó„Å¶Ëâ≤„ÇíÂ§â„Åà„Çã
                // „Åì„Åì„Åß„ÅØÁ∞°ÊòìÁöÑ„Å´„ÄÅÂÖ®„Éú„Çø„É≥‰Ωú„ÇäÁõ¥„Åô„ÅÆ„Åß„ÅØ„Å™„ÅèËâ≤„Å†„ÅëÂ§â„Åà„Çã
            });
        }

        setTimeout(() => {
            currentIndex++;
            if (currentIndex < 10) {
                showQuestion();
            } else {
                endGame();
            }
        }, 1000);
    }

    function endGame() {
        showSection('result-section');
        document.getElementById('score-text').innerText = `${score} / 10`;
        const rewardArea = document.getElementById('reward-area');
        
        if (score >= 7) {
            document.getElementById('result-title').innerText = "PASS! CONGRATULATIONS!";
            document.getElementById('result-title').style.color = "var(--success)";
            
            // Êñ∞„Åó„ÅÑ„Çπ„Çø„É≥„Éó„ÇíÊäΩÈÅ∏ÔºàÊåÅ„Å£„Å¶„ÅÑ„Å™„ÅÑ„ÇÇ„ÅÆ„ÇíÂÑ™ÂÖàÔºâ
            const uncollected = stampData.filter(s => !userStamps.includes(s.id));
            let newStampId;
            
            if (uncollected.length > 0) {
                const random = uncollected[Math.floor(Math.random() * uncollected.length)];
                newStampId = random.id;
            } else {
                // ÂÖ®ÈÉ®ÊåÅ„Å£„Å¶„ÅÑ„Åü„Çâ„É©„É≥„ÉÄ„É†
                newStampId = stampData[Math.floor(Math.random() * stampData.length)].id;
            }

            // ‰øùÂ≠ò
            if (!userStamps.includes(newStampId)) {
                userStamps.push(newStampId);
                localStorage.setItem('eiken5_stamps', JSON.stringify(userStamps));
                
                const stampObj = stampData.find(s => s.id === newStampId);
                rewardArea.innerHTML = `
                    <p>New Stamp Get!</p>
                    <div class="stamp-reveal">${stampObj.icon}</div>
                    <p>${stampObj.word}</p>
                `;
            } else {
                rewardArea.innerHTML = `<p>Great job! Try again for more stamps!</p>`;
            }

        } else {
            document.getElementById('result-title').innerText = "TRY AGAIN...";
            document.getElementById('result-title').style.color = "var(--danger)";
            rewardArea.innerHTML = `<p>You need 7 points to pass.</p>`;
        }
    }

    // --- 5. „Çπ„Çø„É≥„ÉóÂ∏≥„É≠„Ç∏„ÉÉ„ÇØ ---

    function showStampBook() {
        showSection('stamp-book-section');
        const grid = document.getElementById('stamp-grid');
        grid.innerHTML = "";

        stampData.forEach(s => {
            const slot = document.createElement('div');
            slot.className = 'stamp-slot';
            
            if (userStamps.includes(s.id)) {
                slot.innerText = s.icon;
                slot.onclick = () => showModal(s);
            } else {
                slot.classList.add('locked');
                slot.innerText = "‚ùì";
            }
            grid.appendChild(slot);
        });
    }

    function showModal(stamp) {
        document.getElementById('modal').style.display = 'flex';
        document.getElementById('modal-icon').innerText = stamp.icon;
        document.getElementById('modal-jp').innerText = `${stamp.word} : ${stamp.jp}`;
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
    }

    // --- „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£ ---
    function showSection(id) {
        document.getElementById('start-section').style.display = 'none';
        document.getElementById('quiz-section').style.display = 'none';
        document.getElementById('result-section').style.display = 'none';
        document.getElementById('stamp-book-section').style.display = 'none';
        
        document.getElementById(id).style.display = 'block';
    }
    
    function toTitle() {
        showSection('start-section');
    }

</script>
</body>
</html>
